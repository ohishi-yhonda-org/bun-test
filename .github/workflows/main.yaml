name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: [self-hosted, Windows, X64]

    steps:
      - uses: actions/checkout@v3
      
      - name: Verify Node.js and npm
        run: |
          Write-Output "Node.js version: $(node --version)"
          Write-Output "npm version: $(npm --version)"
        shell: powershell
        
      - name: list files
        run: Get-ChildItem
        shell: powershell
        
      - name: Install Bun
        run: |
          $bunPath = "C:\Users\Administrator\AppData\Roaming\bun\bin"
          if (-not (Test-Path $bunPath)) {
            Write-Output "Bun not found, installing..."
            iwr https://bun.sh/install | iex
          } else {
            Write-Output "Bun is already installed."
          }
        shell: powershell
        
      - name: generate Prisma client
        run: npx prisma generate
        shell: powershell
        
      - name: Build project (if available)
        run: |
          $packageJson = Get-Content "package.json" | ConvertFrom-Json
          if ($packageJson.scripts.build) {
            npm run build
          } else {
            Write-Output "No build script found, skipping build"
          }
        shell: powershell 
